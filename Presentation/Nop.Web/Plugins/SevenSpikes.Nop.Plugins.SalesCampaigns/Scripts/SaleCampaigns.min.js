/*
* Copyright 2015 Seven Spikes Ltd. All rights reserved. (http://www.nop-templates.com)
* http://www.nop-templates.com/t/licensinginfo
*/

!function(a,b,c){function i(){var a={day:c.getAttrValFromDom(d,"data-localization-day"),days:c.getAttrValFromDom(d,"data-localization-days"),hour:c.getAttrValFromDom(d,"data-localization-hour"),hours:c.getAttrValFromDom(d,"data-localization-hours"),minute:c.getAttrValFromDom(d,"data-localization-minute"),minutes:c.getAttrValFromDom(d,"data-localization-minutes"),second:c.getAttrValFromDom(d,"data-localization-second"),seconds:c.getAttrValFromDom(d,"data-localization-seconds")};return a}function j(){var a=[];return b(e).each(function(){var c=b(this).attr("data-productid");if(c&&c>0){var d={productId:c,productElement:b(this)};a.push(d)}}),a}function k(a,e){var f=c.getAttrValFromDom(d,"data-productbox-picture-container-selector");if(f){var g=e.productElement.find(f);if(!g.length&&e.productElement.is(f)&&(g=e.productElement),g&&e.productId&&e.productId>0){var h=e.productId,i=b(a).filter("div[data-productId='"+h+"']");if(i&&i.length>0){var j=b(g).find("div.countdownTimer");j.length>0&&j.remove(),b(g).prepend(i)}}}}function l(a,b){if(b&&b.length>0){for(var c=0;c<b.length;c++){var d=b[c];k(a,d)}r(),m(a),q()}}function m(a){var c=b("div#countdownTimerContainer > span[data-time]");if(c.length){var d=parseInt(c.attr("data-campaignid"));if(!(d<=0)){var e=b(a).filter("div[data-campaignId='"+d+"']").first();if(e.length>0){var f=e.attr("data-time");c.attr("data-time",f)}}}}function n(){return c.getAttrValFromDom(d,"data-retrieve-sales-campaings-url")}function o(a,c,d,e){var f=Math.floor(c/60/60/24),g=c/60/60;10!==d&&(g%=24),g=Math.floor(g);var i=Math.floor(c/60%60),j=c%60,k="";if(10!==d){var l=1!==f?h.days:h.day;if(e){var m=b(a).find(".days");m.children(".sale-campaign-box").text(f),m.children(".sale-campaign-box-label").text(l)}else k+=f+" "+l}if(15!==d){var n=1!==g?h.hours:h.hour,o=1!==i?h.minutes:h.minute,p=1!==j?h.seconds:h.second;if(e){var q=b(a).find(".hours");q.children(".sale-campaign-box").text(g),q.children(".sale-campaign-box-label").text(n);var r=b(a).find(".minutes");r.children(".sale-campaign-box").text(i),r.children(".sale-campaign-box-label").text(o);var s=b(a).find(".seconds");s.children(".sale-campaign-box").text(j),s.children(".sale-campaign-box-label").text(p)}else 10!==d&&(k+=", "),k+=g+" "+n+", ",k+=i+" "+o+", ",k+=j+" "+p}e||b(a).html(k)}function p(a,c,d){return o(a,c,d,a.hasClass("category-countdown")),c-=1,a.attr("data-time",c),c<0&&(a.hasClass("category-countdown")?b(a).remove():b(a).parent().remove(),clearInterval(g),s(g)),c}function q(){b(".countdownTimer").each(function(){var a=b(this),c=a.attr("data-time"),d=parseInt(c),e=a.attr("data-clocktype"),h=parseInt(e);d=p(a,d,h),g=setInterval(function(){d=p(a,d,h)},1e3),f.push(g)})}function r(){for(var a=0;a<f.length;a++)clearInterval(f[a]);f=[]}function s(a){var b=f.indexOf(a);b!==-1&&f.splice(b,1)}var e,g,h,d="#sales-campaign-info",f=[];a.getCountdownTimers=function(){var a=j();if(a&&0!==a.length){var c=b.map(a,function(a){return a.productId});if(0!==c.length){var d={productIds:c},e=n();b.ajax({type:"POST",data:b.toJSON(d),contentType:"application/json; charset=utf-8",url:e}).done(function(c){c&&(l(c,a),b.event.trigger({type:"nopSalesCampaignsLoadingCompleteEvent"}))})}}},b(document).ready(function(){e=c.getAttrValFromDom(d,"data-productbox-selector"),e&&(h=i(),a.getCountdownTimers(),q())}),b(document).on("nopAjaxFiltersFiltrationCompleteEvent newProductsAddedToPageEvent",a.getCountdownTimers)}(window.nopSalesCampaigns=window.nopSalesCampaigns||{},jQuery,sevenSpikes);