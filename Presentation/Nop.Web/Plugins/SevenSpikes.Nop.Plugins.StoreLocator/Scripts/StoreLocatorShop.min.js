function loadMapScript(){var i=$(".shop-resources").attr("data-googleapikey").trim(),n="https://maps.googleapis.com/maps/api/js?callback=initializeMap",t;i&&(n=n+"&key="+i);t=document.createElement("script");t.src=n;document.body.appendChild(t)}function getCustomMapStyles(){var n=$(".shop-resources").attr("data-mapstyles"),t="";if(!n)return"";try{t=JSON.parse(n)}catch(i){console.log("Invalid custom map styles value!")}return t}function initializeMap(){var n=document.getElementById(mapWrapperId),t={center:new google.maps.LatLng(shopX,shopY),zoom:18,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:getCustomMapStyles()};map=new google.maps.Map(n,t);google.maps.event.addListenerOnce(map,"idle",onMapLoad)}function onMapLoad(){var n={lat:shopX,lng:shopY};addMarker(n,shopElement.siblings("h1").text(),!1);directionsService=new google.maps.DirectionsService;directionsDisplay=new google.maps.DirectionsRenderer;directionsDisplay.setPanel(document.getElementById("directions-panel"))}function addMarker(n,t,i){var r=new google.maps.Marker({position:new google.maps.LatLng(n.lat,n.lng),map:map,title:t,draggable:i});return markers.push(r),r.setMap(map),map.setCenter(new google.maps.LatLng(n.lat,n.lng)),markers.length-1}function setAllMap(n){for(var t=0;t<markers.length;t++)markers[t].setMap(n)}function clearMarkers(){setAllMap(null)}function showMarkers(){setAllMap(map)}function deleteMarkers(){clearMarkers();markers=[]}function getUserGeoLocation(){var n="Geolocation is not supported by this browser.";return navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){n="Now we use your current position. ( Maybe a confirmation is required by the browser to use it. )";var i=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);createUserMarker(i);userMarker.setPosition(i);map.setCenter(i);showDirectionsToShop()},function(n){$(".get-directions-to-shop").hide();$(".shop-map .additional-info").text("User Geolocation denied. You should enable it from browser permissions settings. Setting the marker to default position...");var t=new google.maps.LatLng(map.center.lat(),map.center.lng());createUserMarker(t);userMarker.setPosition(t);showDirectionsToShop();console.log(n)}),n}function createUserMarker(n){if(!isUserMarkerCreated){var i=$(".shop-resources").attr("data-pathtoimages")+"/squat_marker_green_thumb.png",t=new google.maps.Marker({position:n,map:map,icon:i,animation:google.maps.Animation.DROP,title:$(".shop-resources").attr("data-youarehere"),draggable:!0});t.setMap(map);userMarker=t;isUserMarkerCreated=!0;google.maps.event.addListener(t,"dragend",function(){showDirectionsToShop()})}}function showDirectionsToShop(){if(isUserMarkerCreated&&markers[0]!=null){var n=$(".shop-resources").attr("data-units")=="Imperial",t={origin:new google.maps.LatLng(userMarker.position.lat(),userMarker.position.lng()),destination:new google.maps.LatLng(markers[0].position.lat(),markers[0].position.lng()),travelMode:google.maps.TravelMode.DRIVING,unitSystem:n?google.maps.UnitSystem.IMPERIAL:google.maps.UnitSystem.METRIC};directionsService.route(t,function(n,t){t==google.maps.DirectionsStatus.OK&&(directionsDisplay.setMap(map),directionsDisplay.setDirections(n));$(".directions-wrapper").addClass("directions-shown")})}}var mapWrapperId="shop-map-holder",shopCoordinatesElementClass=".shop-coordinates",shopElement,directionsService,directionsDisplay,map,markers=[],userMarker,isUserMarkerCreated=!1,shopX=0,shopY=0;$(document).ready(function(){if($(shopCoordinatesElementClass).length>0&&document.getElementById(mapWrapperId)!=null){shopElement=$(shopCoordinatesElementClass);shopX=shopElement.attr("data-latitude");shopY=shopElement.attr("data-longitude");loadMapScript();$(".shop-map-images .main-picture-link, .all-shop-images > li > a").magnificPopup({type:"image",removalDelay:300,gallery:{enabled:!0}});$(".get-directions-to-shop").one("click",function(n){n.preventDefault();getUserGeoLocation()})}});