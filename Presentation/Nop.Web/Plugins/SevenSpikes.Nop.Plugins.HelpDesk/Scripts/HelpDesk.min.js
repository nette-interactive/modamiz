function isSafari(){return/^((?!chrome).)*safari/i.test(navigator.userAgent)}function display_kendoui_grid_error(a){if(a.errors)if("string"==typeof a.errors)alert(a.errors);else{var b="The following errors have occurred:";$.each(a.errors,function(a,c){c.errors&&(b+="\n",b+=c.errors.join("\n"))}),alert(b)}else alert("Error happened")}function updateURLParameter(a,b,c,d){var e="",f=a.split("?"),g=f[0],h=f[1],j="";if(h)for(f=h.split("&"),i=0;i<f.length;i++)f[i].split("=")[0]!=b&&(e+=j+f[i],j="&");var k="";d||(k=j+""+b+"="+c);var l="";return""==e&&""==k||(l="?"+e+k),g+l}function prettyDate(a){if(null!=a&&a.length>0){var b=a.slice(-1).toLowerCase();"z"==b&&(a=a.substring(0,a.length-1))}return a}function applyFilter(a,b,c,d){"undefined"==typeof c&&(c="eq"),"undefined"==typeof d&&(d=!1);var e="#"+sevenSpikes.getHiddenValFromDom("#grid-id"),f=$(e).data("kendoGrid"),g=f.dataSource.filter(),h=g?g.filters:[],i=!1;if(h&&h.length>0)for(var j=0;j<h.length;j++)if(h[j].field==a&&(h[j].value==b&&(i=!0),h[j].value==b&&"contains"===c||h[j].value!==b&&"contains"!==c)){h.splice(j,1);break}"-1"!=b&&"undefined"!=typeof b&&null!=b&&b.toString().length>0&&!d&&!i&&h.push({field:a,operator:c,value:b}),f.dataSource.filter({logic:"and",filters:h})}function RemoveQueryParameter(a){if(window.location.href.indexOf(a)!==-1){var b=updateURLParameter(window.location.href,a,"0",!0);if(!window.history||!window.history.pushState)return void(window.location.href=b);window.history.pushState("",a+" = 0",b);var c=$("#managetickets-grid").data("kendoGrid"),d=c.dataSource.transport.options.read.url,e=updateURLParameter(d,a,"0");c.dataSource.transport.options.read.url=e}}function clearFilters(){RemoveQueryParameter("status"),RemoveQueryParameter("customerId");var a="#"+sevenSpikes.getHiddenValFromDom("#grid-id"),b=$(a).data("kendoGrid");b.dataSource.filter({logic:"and",filters:[]}),$("#ticket-id").data("kendoNumericTextBox").value(""),$("#subject-field").data("kendoAutoComplete").value(""),$("#product-field").data("kendoMultiSelect").value(""),$("#status-list").data("kendoDropDownList").value("-1"),$("#departments-list").data("kendoDropDownList").value("-1"),$("#staff-list").length>0&&$("#staff-list").data("kendoDropDownList").value("-1"),$("#customer-property-field").length>0&&$("#customer-property-field").data("kendoDropDownList").value("0"),$("#customer-field").length>0&&($("#customer-field").data("kendoMultiSelect").value(""),$("#customer-field").data("kendoMultiSelect").enable(!1)),$("#date-from").length>0&&$("#date-from").val(""),$("#date-to").length>0&&$("#date-to").val("")}function onTicketProductChange(){var a=this.value();if($.isArray(a)&&a.length>0)for(var b=0;b<a.length;b++)applyFilter("Product_"+a[b],a[b]);var c=this._savedOld,d=[],e=this.value();c&&(d=$(c).not(e).get()),this._savedOld=e.slice(0),d.length>0&&applyFilter("Product_"+d,d.toString(),"eq",!0)}function onTicketSubjectChange(){applyFilter("Subject",this.value())}function onCustomerChange(){0===this.value().length&&RemoveQueryParameter("customerId"),applyFilter("Customer",this.value()[0])}function onTicketStatusChange(){RemoveQueryParameter("status"),applyFilter("TicketStatus",this.value())}function onTicketDeparmentChange(){applyFilter("TicketDepartment.Id",this.value())}function onTicketStaffChange(){applyFilter("TicketOwnerId",this.value())}function onTicketIdChange(){applyFilter("Id",this.value())}function onDateFromChange(a){applyFilter("DateFrom",a,"gte")}function onDateToChange(a){applyFilter("DateTo",a,"lte")}window.onpopstate=function(a){a&&!isSafari()&&location.reload()},$(document).ready(function(){$("#ticket-id").kendoNumericTextBox({step:1,format:"#",decimals:0,change:onTicketIdChange,spin:onTicketIdChange});var a=localDatabase();$("#staff-list").length>0&&$("#staff-list").kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:a.allStaff,change:onTicketStaffChange,optionLabel:{text:"-- select --",value:"-1"}}),$("#departments-list").kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:a.allDepartments,change:onTicketDeparmentChange,optionLabel:{text:"-- select --",value:"-1"}});var b="",c=sevenSpikes.getHiddenValFromDom("#selected-status");c.length>0&&(b=parseInt(c)),$("#status-list").kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:a.allStatus,change:onTicketStatusChange,optionLabel:{text:"-- select --",value:"-1"},value:b}),$("#subject-field").kendoAutoComplete({autoBind:!1,change:onTicketSubjectChange,filter:"contains",minLength:3,dataSource:{serverFiltering:!0,transport:{read:{url:sevenSpikes.getHiddenValFromDom("#read-allSubjects-url"),type:"POST",dataType:"json",contentType:"application/json"},parameterMap:function(a,b){return"read"!=b?a:JSON.stringify(a)}}}}),$("#customer-property-field").length>0&&$("#customer-property-field").kendoDropDownList({optionLabel:"Select customer property...",dataTextField:"text",dataValueField:"value",change:function(a){var b=$("#customer-field").data("kendoMultiSelect"),c=0!=a.sender.selectedIndex;b.enable(c);var d=10==this.value()?1:3;b.options.minLength=d,b.value("")},dataSource:a.allCustomerProperties}).data("kendoDropDownList").wrapper.width(200);var d=sevenSpikes.getHiddenValFromDom("#no-results-found");if($("#customer-field").length>0){var e=sevenSpikes.getHiddenValFromDom("#selected-customer-id"),f=sevenSpikes.getHiddenValFromDom("#selected-customer-term"),g=[];e.length>0&&f.length>0&&g.push({CustomerId:e,CustomerTerm:f}),$("#customer-field").kendoMultiSelect({enable:!1,autoBind:!1,minLength:3,maxSelectedItems:1,dataValueField:"CustomerId",dataTextField:"CustomerTerm",change:onCustomerChange,select:function(a){a.item.text()===d&&(a.sender.dataSource.data([]),a.sender.input.blur(),a.preventDefault())},dataSource:{serverFiltering:!0,transport:{read:{url:sevenSpikes.getHiddenValFromDom("#read-customers-url"),type:"POST",dataType:"json",contentType:"application/json",data:function(){return{type:$("#customer-property-field").data("kendoDropDownList").value()}}},parameterMap:function(a,b){return"read"!=b?a:JSON.stringify(a)}},requestEnd:function(a){a.response.length||a.response.push({CustomerTerm:d,CustomerId:0})}},value:g})}$("#product-field").kendoMultiSelect({autoBind:!1,minLength:sevenSpikes.getHiddenValFromDom("#minimum-product-search-keyword"),maxSelectedItems:sevenSpikes.getHiddenValFromDom("#max-ticket-products"),dataValueField:"ProductId",dataTextField:"ProductName",change:onTicketProductChange,select:function(a){a.item.text()===d&&(a.sender.dataSource.data([]),a.sender.input.blur(),a.preventDefault())},dataSource:{serverFiltering:!0,transport:{read:{url:sevenSpikes.getHiddenValFromDom("#read-allProducts-url"),type:"POST",dataType:"json",contentType:"application/json",data:function(){return{sc:sevenSpikes.getHiddenValFromDom("#should-check")}}},parameterMap:function(a,b){return"read"!=b?a:JSON.stringify(a)}},requestEnd:function(a){a.response.length||a.response.push({ProductName:d,ProductId:0})}}}),$("#date-from").length>0&&$("#date-from").datepicker({dateFormat:"mm/dd/yy",onSelect:onDateFromChange}),$("#date-to").length>0&&$("#date-to").datepicker({dateFormat:"mm/dd/yy",onSelect:onDateToChange}),$("#clear").click(function(){clearFilters()})});