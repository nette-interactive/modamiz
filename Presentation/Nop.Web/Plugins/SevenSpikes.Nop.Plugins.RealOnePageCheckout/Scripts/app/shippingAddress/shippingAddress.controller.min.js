"use strict";function ShippingAddressController(n,t,i,r,u){function h(){var n=f.configData.isVisible;f.requiredFields={firstName:n,lastName:n,email:n,company:n&&f.shippingData.settings.companyEnabled!==!1&&f.shippingData.settings.companyRequired,country:n&&f.shippingData.settings.countryEnabled!==!1,stateProvince:n&&f.shippingData.settings.stateProvinceEnabled,city:n&&f.shippingData.settings.cityEnabled!==!1&&f.shippingData.settings.cityRequired,address1:n&&f.shippingData.settings.streetAddressEnabled!==!1&&f.shippingData.settings.streetAddressRequired,address2:n&&f.shippingData.settings.streetAddress2Enabled!==!1&&f.shippingData.settings.streetAddress2Required,zipPostalCode:n&&f.shippingData.settings.zipPostalCodeEnabled!==!1&&f.shippingData.settings.zipPostalCodeRequired,phoneNumber:n&&f.shippingData.settings.phoneEnabled!==!1&&f.shippingData.settings.phoneRequired,faxNumber:n&&f.shippingData.settings.faxEnabled!==!1&&f.shippingData.settings.faxRequired}}function c(){f.shippingData.selectedShippingAddress={country:{},stateProvince:{}};r.set(f.shippingData.selectedShippingAddress)}function l(){var n=!0;t.$watch("vm.shippingData.selectedShippingAddress",function(t,i){t&&i&&!n?r.set(t):n=!1},!0)}var f=this;f.shippingData={};f.configData={};f.configData.isVisible=!0;var s=!1,e=!1,o=!1;f.addressAttributeChanged=function(n,t){u.syncAttributeWithModel(t,n)};n.$on("checkoutDataLoaded",function(n,t){r.init(t);var i=r.get();angular.copy(i,f.shippingData);angular.isDefined(t.configuration.shipToSameAddress)&&(s=t.configuration.shipToSameAddress);angular.isDefined(t.configuration.hasProductsRequiringShipping)&&(o=t.configuration.hasProductsRequiringShipping);angular.isDefined(t.configuration.pickUpInStoreOnly)&&(e=t.configuration.pickUpInStoreOnly);f.configData.isVisible=!s&&!e&&o;!angular.isDefined(f.requiredFields)&&angular.isDefined(f.shippingData.settings)&&h();f.shippingData.selectedShippingAddress&&f.shippingData.selectedShippingAddress.customAddressAttributes&&f.shippingData.selectedShippingAddress.customAddressAttributes.length>0&&!angular.isDefined(f.modelsData)&&(f.modelsData={},u.prepareDefaultSelectedValues(f.shippingData.selectedShippingAddress,f.modelsData));l()});n.$on("togglePanel",function(n,t){angular.isDefined(t.shipToSameAddress)&&(s=t.shipToSameAddress);angular.isDefined(t.pickUpInStore)&&(e=t.pickUpInStore,e===!0&&c());angular.isDefined(t.hasProductsRequiringShipping)&&(o=t.hasProductsRequiringShipping,o!==!1||e||c());f.configData.isVisible=!(s||e)&&o;angular.isDefined(f.shippingData.settings)&&h();var i=r.get();angular.copy(i,f.shippingData)});n.$on("updateShippingAddress",function(n,t){t&&t.address&&(angular.copy(t.address,f.shippingData.selectedShippingAddress),u.prepareDefaultSelectedValues(f.shippingData.selectedShippingAddress,f.modelsData))});n.$on("refresh",function(n,t){if(!(t.controller==undefined||t.controller=="ShippingAddressController"))return!1;var i=r.get();angular.copy(i,f.shippingData);!angular.isDefined(f.requiredFields)&&angular.isDefined(f.shippingData.settings)&&h();f.shippingData.selectedShippingAddress&&f.shippingData.selectedShippingAddress.customAddressAttributes&&f.shippingData.selectedShippingAddress.customAddressAttributes.length>0&&!angular.isDefined(f.modelsData)&&(f.modelsData={},u.prepareDefaultSelectedValues(f.shippingData.selectedShippingAddress,f.modelsData));u.hideOverlay(".shipping-address-loader")});n.$on("setShippingAddressOverlay",function(){u.showOverlay(".shipping-address-loader")});n.$on("prepareDefaultSelectedValuesForCustomAddressAttributes",function(n,i){(i.panel=="shipping"||i.panel=="billing"&&i.shipToSameAddress)&&setTimeout(function(){t.$apply(function(){u.prepareDefaultSelectedValues(f.shippingData.selectedShippingAddress,f.modelsData)})})});$(".shipping-address .choose-address select").change(function(){n.$broadcast("addressChanged",{panel:"shipping",shipToSameAddress:f.shipToSameAddress})})}angular.module("realOnePageCheckout.shippingAddress").controller("ShippingAddressController",ShippingAddressController);ShippingAddressController.$inject=["$rootScope","$scope","$timeout","shippingAddressContext","objectUtility"];